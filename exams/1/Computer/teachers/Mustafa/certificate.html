<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</title>
<link href="../../../../../package/dist/tailwind.css" rel="stylesheet">
<link href="../../../../../fonts.css" rel="stylesheet">
<script src="rules.js"></script>
<script src="info_temp.js"></script>
<style>
  body {
    font-family: 'Cairo', sans-serif;
    background-color: #f3f4f6;
    margin: 0;
    padding: 0;
  }

  /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø¨Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„ */
  .top-bar {
    width: 100%;
    background-color: #1f2937;
    padding: 10px 0;
    text-align: center;
    position: sticky;
    top: 0;
    z-index: 10;
  }

  #printBtn {
    background-color: #2563eb;
    color: white;
    padding: 10px 20px;
    border-radius: 12px;
    cursor: pointer;
    font-weight: bold;
    font-size: 1rem;
  }

  .certificate {
    width: 210mm; /* Ø¹Ø±Ø¶ A4 */
    height: 297mm; /* Ø·ÙˆÙ„ A4 */
    padding: 40px;
    border: 8px solid #1f2937;
    background-color: #fff;
    border-radius: 16px;
    box-shadow: 0 0 20px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    margin: 20px auto;
  }

  .certificate h1 {
    font-size: 2.5rem;
  }

  .certificate h2 {
    font-size: 1.5rem;
  }

  .barcode {
    width: 300px;
    height: 80px;
    margin: 20px auto 0 auto;
  }

  .url-text {
    text-align: center;
    font-size: 0.8rem;
    color: #555;
    margin-top: 5px;
    word-break: break-all;
  }

  .signature {
    text-align: center;
  }

  .signature img {
    width: 150px;
    height: auto;
    margin: 0 10px;
  }

  /* Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
  @media print {
    body {
      background-color: #fff;
    }
    .top-bar {
      display: none;
    }
    .certificate {
      width: auto;
      height: auto;
      box-shadow: none;
      border-radius: 0;
      margin: 0;
    }
  }

  /* Responsive Ù„Ù„Ù‡ÙˆØ§ØªÙ */
  @media (max-width: 768px) {
    .certificate {
      width: 95%;
      height: auto;
      padding: 20px;
    }
    .certificate h1 {
      font-size: 2rem;
    }
    .barcode {
      width: 200px;
      height: 50px;
    }
    .signature img {
      width: 120px;
    }
  }
</style>
</head>
<body>

<!-- Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ ÙƒØ§Ù…Ù„ -->
<div class="top-bar">
  <button id="printBtn" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</button>
</div>

<div class="certificate shadow-lg rounded-xl">

  <!-- Ø´Ø¹Ø§Ø± Ø§Ù„ØµÙØ­Ø© -->
  <div class="text-center mb-8">
    <img src="../../../../../logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ù†ØµØ©" class="mx-auto w-32">
    <h1 class="font-bold mt-4 text-3xl">Ø´Ù‡Ø§Ø¯Ø© Ø§Ù†Ø¬Ø§Ø²</h1>
  </div>
  
 <div class="text-center mb-8">
    <h2 class="font-bold mt-4 text-3xl">ØªÙ… Ø§Ù†Ø¬Ø§Ø² Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ ÙÙŠ Ù…Ø§Ø¯Ø© </h2>
         <h2 id="subjectName" class="font-bold mt-4 text-3xl">  </h2> 

  </div>


  <!-- Ù†Øµ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© -->
  <div class="text-center text-lg space-y-4 px-8">
    <p>Ù‚Ø¯ ØªÙ… Ù…Ù†Ø­ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ Ø§Ù„Ù…Ø°ÙƒÙˆØ± Ø§Ø³Ù…Ù‡ Ø£Ø¹Ù„Ø§Ù‡ Ø¨ÙŠØ§Ù†Ø§Ù‹ Ø¨Ù†Ø¬Ø§Ø­Ù‡ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ù‚Ø±Ø± ÙˆØ¨Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ§Ù„ÙŠØ©:</p>
    
    <p>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ: <strong id="studentNameDisplay">---</strong></p>
    <!-- Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø£Ø³ÙÙ„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© -->

    <p>Ø¯Ø±Ø¬Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: <strong id="finalScore">0</strong> / <strong id="fullScore">0</strong></p>
    <p>Ø§Ù„ØªÙ‚Ø¯ÙŠØ±: <strong id="rating">---</strong></p>
    <p>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø¬Ø²: <strong id="timeTaken">0</strong> Ø¯Ù‚ÙŠÙ‚Ø©</p>
    <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: <strong id="completionDate">---</strong></p>
  </div>

  <!-- Ø§Ù„ØªÙˆØ§Ù‚ÙŠØ¹ -->
  <div class="flex justify-center mt-12">
    <div class="signature">
        <img src="signature_dev.png" alt="ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø·ÙˆØ±">
        <p id="Namedev"> Ù…ØµØ·ÙÙ‰ Ø±Ø­ÙŠÙ… ÙÙ†Ø¯ÙŠ</p>
    </div>
    <div class="signature">
        <!-- ØµÙˆØ±Ø© ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø£Ø³ØªØ§Ø° -->
        <img id="teacherSignature" src="" alt="ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø£Ø³ØªØ§Ø°">
        <!-- Ø§Ø³Ù… Ø§Ù„Ø£Ø³ØªØ§Ø° -->
        <p id="teacher"></p>
    </div>
</div>

<script>
// Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³ØªØ§Ø° Ù…Ù† rules.js
document.getElementById("teacher").textContent = rules.name_teacher || "Ø£. [Ø§Ø³Ù… Ø§Ù„Ø£Ø³ØªØ§Ø°]";
document.getElementById("teacherSignature").src = rules.signature_image || "/uploads/default_signature.png";
</script>

  <!-- Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙƒØ¨ÙŠØ± Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© -->
<!-- Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙƒØ¨ÙŠØ± Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© -->
<canvas id="qrcode" class="barcode"></canvas>

  <!-- Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø© Ø£Ø³ÙÙ„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ -->
  <div class="url-text" id="pageUrl"></div>

</div>


<script src="../../../../../js/qrcode.min.js"></script>
<script>
window.onload = function() {
    const fullScore = parseInt(localStorage.getItem('totalScore')) || 100;
    let storedInfo = localStorage.getItem('studentInfo');
    const studentInfoData = storedInfo ? JSON.parse(storedInfo) : {name:"Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ", currentScore:0, date:new Date(), rating:"Ù…Ù‚Ø¨ÙˆÙ„", timeTaken:0};
    
    document.getElementById("studentNameDisplay").textContent = studentInfoData.name;
    document.getElementById("finalScore").textContent = studentInfoData.currentScore;
    document.getElementById("fullScore").textContent = fullScore;
    document.getElementById("rating").textContent = studentInfoData.rating;
    document.getElementById("timeTaken").textContent = studentInfoData.timeTaken;
    document.getElementById("completionDate").textContent = new Date().toLocaleString();
    // ØªØ­Ù…ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ù…Ù† rules.js
document.getElementById("subjectName").textContent = rules.subject || "Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©";

    // Ø¨ÙŠØ§Ù†Ø§Øª QR
const asciiName = studentInfoData.name.replace(/[^\w]/g, "");

// Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ø¨Ø§Ø´Ø±Ø©
const now = new Date();
const dateCode = now.toISOString().split('T')[0].replace(/-/g,''); // YYYYMMDD
const timeCode = now.getHours().toString().padStart(2,'0') + now.getMinutes().toString().padStart(2,'0');

const score = studentInfoData.currentScore;

// ØªÙˆÙ„ÙŠØ¯ Ø¨ÙŠØ§Ù†Ø§Øª QR
const qrData = `${asciiName},${dateCode}${timeCode},${score}`;


    // ØªÙˆÙ„ÙŠØ¯ QR Code
    const canvas = document.getElementById('qrcode');
    if(canvas){
        QRCode.toCanvas(canvas, qrData, {
            width: 250,
            color: {dark: '#1f2937', light:'#ffffff'}
        }, function (error) {
            if(error) console.error("Ø®Ø·Ø£ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ QR Code:", error);
        });
    } else {
        console.error("Ø¹Ù†ØµØ± QR Code ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!");
    }

    // Ø¹Ø±Ø¶ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø© Ø£Ø³ÙÙ„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
    document.getElementById("pageUrl").textContent = window.location.href;
};
</script>



</body>
</html>
